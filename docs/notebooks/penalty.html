<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A fixed point iteration â€“ Self tuning penalty</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Self tuning penalty</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A fixed point iteration</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="e8f0138c-3109-4b9b-9848-b8cc22602544" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jax.scipy.interpolate <span class="im">import</span> RegularGridInterpolator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="81e5b5e8-b8f9-43fc-96f5-fd23eed31ad8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gaussian_mgf(eta, sigma<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jnp.exp((sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> eta<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> exponential_mgf(eta, rate<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (rate <span class="op">/</span> (rate <span class="op">-</span> eta))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> laplace_mgf(eta, scale<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> (scale <span class="op">*</span> eta)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cdf(mgf, vmap<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> cdf(eta):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.log(mgf(eta))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    cdf_prime <span class="op">=</span> jax.grad(cdf)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> vmap:</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.jit(jax.vmap(cdf)), jax.jit(jax.vmap(cdf_prime))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.jit(cdf), jax.jit(cdf_prime)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_point_mgf(mgf, pi):</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> point_mgf(eta):</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> pi) <span class="op">+</span> pi <span class="op">*</span> mgf(eta)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> point_mgf</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_mixture_mgf(mgfs, pis):</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> point_mgf(eta):</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        mgf_eval <span class="op">=</span> jnp.array([f(eta) <span class="cf">for</span> f <span class="kw">in</span> mgfs])</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jnp.<span class="bu">sum</span>(pis <span class="op">*</span> mgf_eval)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> point_mgf</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_penalty(kappa):</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    kappa_prime_inv <span class="op">=</span> invert(jax.grad(kappa))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">@jax.jit</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">@partial</span>(jax.vmap, in_axes<span class="op">=</span>(<span class="dv">0</span>))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> rho(theta):</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> theta <span class="op">*</span> kappa_prime_inv(theta) <span class="op">-</span> kappa(kappa_prime_inv(theta))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rho</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> point_cdf(eta, sigma<span class="op">=</span><span class="dv">1</span>, pi<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pi <span class="op">*</span> jax.grad(gaussian_mgf)(eta) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> pi <span class="op">+</span> pi <span class="op">*</span> gaussian_mgf(eta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\nu_{g, \sigma, t}(\theta) = \kappa^\prime_g((t-\theta)/\sigma^2)) = \theta
\]</span></p>
<p>Notice that <span class="math inline">\(\nu(t) = 0\)</span> and <span class="math inline">\(\nu(0) = t\)</span> when <span class="math inline">\(g\)</span> is a mean zero prior. Since it may alternate, I propose taking a running average of the iterates. I think a strategy like this should converge to a fixed point.</p>
<div id="97463141-ca05-4c10-a591-ec65a45ddc01" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up prior</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(gaussian_mgf, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(mgf, vmap<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_shrinkage_op(kappa_prime):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> shrinkage_op(t, sigma2):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        nu <span class="op">=</span> <span class="kw">lambda</span> theta: kappa_prime((t <span class="op">-</span> theta)<span class="op">/</span>sigma2)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> scanf(x, it):</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            nux <span class="op">=</span> nu(x)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            xnew <span class="op">=</span> (it<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span>it <span class="op">*</span> x <span class="op">+</span> (<span class="dv">1</span><span class="op">/</span>it) <span class="op">*</span> nu(x)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> xnew, nux</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jax.lax.scan(scanf, t<span class="op">/</span><span class="dv">2</span>, np.arange(<span class="dv">2</span>, <span class="dv">100</span>))[<span class="dv">0</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> shrinkage_op</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ef2a15c0-d430-4c58-85cc-6703c2151d1d" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>kappa_prime <span class="op">=</span> <span class="kw">lambda</span> x: x</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> jax.jit(jax.vmap(partial(make_shrinkage_op(kappa_prime), sigma2<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>plt.plot(z, S(z))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plt.plot(z, z, c<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="37b7a6d9-a299-4bc1-8526-c48c89370f9f" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(z, kappa_prime(z))</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="dv">100</span>) <span class="op">*</span> sigma2 <span class="op">+</span> t</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> <span class="kw">lambda</span> theta: kappa_prime((t<span class="op">-</span>theta)<span class="op">/</span>sigma2)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>plt.plot(z, nu(z))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>plt.plot(z, z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d063ba45-58d2-4386-b0db-4d9aa148f94c" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> partial(make_shrinkage_op(kappa_prime), sigma2<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>S(<span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>Array(0.33633628, dtype=float32)</code></pre>
</div>
</div>
<div id="4da3383a-afdc-4ac3-a18c-857ae9c4080e" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>kappa_prime <span class="op">=</span> <span class="kw">lambda</span> x: <span class="dv">2</span><span class="op">*</span>x<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>x<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.99</span>, <span class="fl">0.99</span>, <span class="dv">100</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(z, kappa_prime(z))</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> jax.jit(jax.vmap(partial(make_shrinkage_op(kappa_prime), sigma2<span class="op">=</span><span class="dv">1</span>)))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.plot(z, S(z))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.plot(z, z, c<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'dotted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d6461d3f-02f0-4ed0-9e3b-47414689da14" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>kappa_prime <span class="op">=</span> <span class="kw">lambda</span> theta: theta</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> make_shrinkage_operator(kappa_prime)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>S(<span class="fl">1.</span>, <span class="fl">1.</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TracerBoolConversionError</span>                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[66]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> kappa_prime = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> theta: theta
<span class="ansi-green-fg">      2</span> S = make_shrinkage_operator(kappa_prime)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> <span class="ansi-yellow-bg">S</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">1.</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">1.</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[65]</span><span class="ansi-green-fg">, line 10</span>, in <span class="ansi-cyan-fg">make_shrinkage_operator.&lt;locals&gt;.shrinkage_op</span><span class="ansi-blue-fg">(t, sigma2)</span>
<span class="ansi-green-fg">      8</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">shrinkage_op</span>(t, sigma2):
<span class="ansi-green-fg">      9</span>     f = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> theta: (kappa_prime((t - theta)/sigma2) - theta)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">10</span>     theta =<span class="ansi-yellow-bg">jax</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">lax</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">cond</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">     11</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">&gt;</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">     12</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">lambda</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">Bisection</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">optimality_fun</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">f</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">lower</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">0.9</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">upper</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">10</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     13</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">lambda</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">Bisection</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">optimality_fun</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">f</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">lower</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">10</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">upper</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">0.9</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">params</span>
<span class="ansi-green-fg">     14</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     15</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> theta

    <span class="ansi-red-fg">[... skipping hidden 10 frame]</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[65]</span><span class="ansi-green-fg">, line 12</span>, in <span class="ansi-cyan-fg">make_shrinkage_operator.&lt;locals&gt;.shrinkage_op.&lt;locals&gt;.&lt;lambda&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">      8</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">shrinkage_op</span>(t, sigma2):
<span class="ansi-green-fg">      9</span>     f = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> theta: (kappa_prime((t - theta)/sigma2) - theta)
<span class="ansi-green-fg">     10</span>     theta =jax.lax.cond(
<span class="ansi-green-fg">     11</span>         t &gt;= <span class="ansi-green-fg">0</span>, 
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">12</span>         <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span>: <span class="ansi-yellow-bg">Bisection</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">optimality_fun</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">f</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">lower</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">0.9</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">upper</span><span class="ansi-yellow-bg">=</span><span class="ansi-green-fg ansi-yellow-bg">10</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>.params,
<span class="ansi-green-fg">     13</span>         <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span>: Bisection(optimality_fun=f, lower=<span class="ansi-green-fg">10</span>*t, upper=<span class="ansi-green-fg">0.9</span>*t).run().params
<span class="ansi-green-fg">     14</span>     )
<span class="ansi-green-fg">     15</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> theta

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:169</span>, in <span class="ansi-cyan-fg">Bisection.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    165</span>         init_params: Optional[Any] = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    166</span>         *args,
<span class="ansi-green-fg">    167</span>         **kwargs) -&gt; base.OptStep:
<span class="ansi-green-fg">    168</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We override run in order to set init_params=None by default.</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">169</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:358</span>, in <span class="ansi-cyan-fg">IterativeSolver.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    351</span>   decorator = idf.custom_root(
<span class="ansi-green-fg">    352</span>       <span style="color:rgb(0,135,0)">self</span>.optimality_fun,
<span class="ansi-green-fg">    353</span>       has_aux=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    354</span>       solve=<span style="color:rgb(0,135,0)">self</span>.implicit_diff_solve,
<span class="ansi-green-fg">    355</span>       reference_signature=reference_signature)
<span class="ansi-green-fg">    356</span>   run = decorator(run)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">358</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:251</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.wrapped_solver_fun</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    249</span> args, kwargs = _signature_bind(solver_fun_signature, *args, **kwargs)
<span class="ansi-green-fg">    250</span> keys, vals = <span style="color:rgb(0,135,0)">list</span>(kwargs.keys()), <span style="color:rgb(0,135,0)">list</span>(kwargs.values())
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">251</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">make_custom_vjp_solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">vals</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 11 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:207</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.make_custom_vjp_solver_fun.&lt;locals&gt;.solver_fun_flat</span><span class="ansi-blue-fg">(*flat_args)</span>
<span class="ansi-green-fg">    204</span> <span style="color:rgb(175,0,255)">@jax</span>.custom_vjp
<span class="ansi-green-fg">    205</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">solver_fun_flat</span>(*flat_args):
<span class="ansi-green-fg">    206</span>   args, kwargs = _extract_kwargs(kwarg_keys, flat_args)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:300</span>, in <span class="ansi-cyan-fg">IterativeSolver._run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    296</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">_run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    297</span>          init_params: Any,
<span class="ansi-green-fg">    298</span>          *args,
<span class="ansi-green-fg">    299</span>          **kwargs) -&gt; OptStep:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">300</span>   state = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">init_state</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    302</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We unroll the very first iteration. This allows `init_val` and `body_fun`</span>
<span class="ansi-green-fg">    303</span>   <span style="font-style:italic;color:rgb(95,135,135)"># below to have the same output type, which is a requirement of</span>
<span class="ansi-green-fg">    304</span>   <span style="font-style:italic;color:rgb(95,135,135)"># lax.while_loop and lax.scan.</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    315</span>   <span style="font-style:italic;color:rgb(95,135,135)"># of a `lax.cond` for now in order to avoid staging the initial</span>
<span class="ansi-green-fg">    316</span>   <span style="font-style:italic;color:rgb(95,135,135)"># update and the run loop. They might not be staging compatible.</span>
<span class="ansi-green-fg">    318</span>   zero_step = <span style="color:rgb(0,135,0)">self</span>._make_zero_step(init_params, state)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:105</span>, in <span class="ansi-cyan-fg">Bisection.init_state</span><span class="ansi-blue-fg">(***failed resolving arguments***)</span>
<span class="ansi-green-fg">     99</span> sign = jnp.where((lower_value &lt; <span class="ansi-green-fg">0</span>) &amp; (upper_value &gt;= <span class="ansi-green-fg">0</span>),
<span class="ansi-green-fg">    100</span>                  <span class="ansi-green-fg">1</span>,
<span class="ansi-green-fg">    101</span>                  jnp.where((lower_value &gt; <span class="ansi-green-fg">0</span>) &amp; (upper_value &lt;= <span class="ansi-green-fg">0</span>), -<span class="ansi-green-fg">1</span>, <span class="ansi-green-fg">0</span>))
<span class="ansi-green-fg">    103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span>.check_bracket:
<span class="ansi-green-fg">    104</span>   <span style="font-style:italic;color:rgb(95,135,135)"># Not jittable...</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">105</span>   <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span class="ansi-yellow-bg">sign</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">==</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">0</span>:
<span class="ansi-green-fg">    106</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">The root is not contained in [lower, upper]. </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    107</span>                      <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">`optimality_fun` evaluated at lower and upper should </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    108</span>                      <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">have opposite signs.</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">    110</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> BisectionState(iter_num=jnp.asarray(<span class="ansi-green-fg">0</span>),
<span class="ansi-green-fg">    111</span>                       value=jnp.asarray(jnp.inf),
<span class="ansi-green-fg">    112</span>                       error=jnp.asarray(jnp.inf),
<span class="ansi-green-fg">    113</span>                       low=lower, high=upper,
<span class="ansi-green-fg">    114</span>                       sign=jnp.asarray(sign),
<span class="ansi-green-fg">    115</span>                       num_fun_eval=jnp.array(<span class="ansi-green-fg">2</span>, base.NUM_EVAL_DTYPE))

    <span class="ansi-red-fg">[... skipping hidden 1 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/core.py:1604</span>, in <span class="ansi-cyan-fg">concretization_function_error.&lt;locals&gt;.error</span><span class="ansi-blue-fg">(self, arg)</span>
<span class="ansi-green-fg">   1603</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">error</span>(<span style="color:rgb(0,135,0)">self</span>, arg):
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1604</span>   <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> TracerBoolConversionError(arg)

<span class="ansi-red-fg">TracerBoolConversionError</span>: Attempted boolean conversion of traced array with shape bool[].
The error occurred while tracing the function solver_fun_flat at /Users/ktayeb/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:204 for custom_vjp fun. This value became a tracer due to JAX operations on these lines:

  operation a:f32[] = convert_element_type[new_dtype=float32 weak_type=False] b
    from line /Users/ktayeb/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:90:12 (Bisection.init_state)

  operation a:f32[] = convert_element_type[new_dtype=float32 weak_type=False] b
    from line /Users/ktayeb/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:91:12 (Bisection.init_state)

  operation a:f32[] = convert_element_type[new_dtype=float32 weak_type=False] b
    from line /var/folders/0q/xlv6fxx51c17jf27j1ws0wx40000gn/T/ipykernel_77668/229207572.py:9:40 (make_shrinkage_operator.&lt;locals&gt;.shrinkage_op.&lt;locals&gt;.&lt;lambda&gt;)

  operation a:f32[] = convert_element_type[new_dtype=float32 weak_type=False] b
    from line /var/folders/0q/xlv6fxx51c17jf27j1ws0wx40000gn/T/ipykernel_77668/229207572.py:9:39 (make_shrinkage_operator.&lt;locals&gt;.shrinkage_op.&lt;locals&gt;.&lt;lambda&gt;)

  operation a:f32[] = convert_element_type[new_dtype=float32 weak_type=False] b
    from line /var/folders/0q/xlv6fxx51c17jf27j1ws0wx40000gn/T/ipykernel_77668/229207572.py:9:40 (make_shrinkage_operator.&lt;locals&gt;.shrinkage_op.&lt;locals&gt;.&lt;lambda&gt;)

(Additional originating lines are not shown.)
See https://jax.readthedocs.io/en/latest/errors.html#jax.errors.TracerBoolConversionError</pre>
</div>
</div>
</div>
<div id="858d36cc-3ec4-4e40-9243-63bd3fc38d4a" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>S(<span class="fl">2.</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>Array(4.000001, dtype=float32)</code></pre>
</div>
</div>
<div id="5ca99b23-8835-46de-aca7-f0fb64014122" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>array([0.        , 0.11111111, 0.22222222, 0.33333333, 0.44444444,
       0.55555556, 0.66666667, 0.77777778, 0.88888889, 1.        ])</code></pre>
</div>
</div>
<div id="a0936ca5-6f9f-4f29-a3c8-b1d76368276b" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Sv <span class="op">=</span> jax.vmap(S, in_axes<span class="op">=</span>(<span class="dv">0</span>, <span class="va">None</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Sv(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>), <span class="fl">1.</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TracerBoolConversionError</span>                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[55]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> Sv = jax.vmap(S, in_axes=(<span class="ansi-green-fg">0</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">Sv</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">np</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">linspace</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">0</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">1</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">10</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">1.</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 7 frame]</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[47]</span><span class="ansi-green-fg">, line 11</span>, in <span class="ansi-cyan-fg">make_shrinkage_operator.&lt;locals&gt;.shrinkage_op</span><span class="ansi-blue-fg">(theta, sigma2)</span>
<span class="ansi-green-fg">      9</span> lower, upper = get_range(jnp.array([theta*<span class="ansi-green-fg">10</span>, theta * <span class="ansi-green-fg">0.9</span>]))
<span class="ansi-green-fg">     10</span> bisec = Bisection(optimality_fun=f, lower=lower, upper=upper)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">11</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">bisec</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>.params

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:169</span>, in <span class="ansi-cyan-fg">Bisection.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    165</span>         init_params: Optional[Any] = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    166</span>         *args,
<span class="ansi-green-fg">    167</span>         **kwargs) -&gt; base.OptStep:
<span class="ansi-green-fg">    168</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We override run in order to set init_params=None by default.</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">169</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:358</span>, in <span class="ansi-cyan-fg">IterativeSolver.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    351</span>   decorator = idf.custom_root(
<span class="ansi-green-fg">    352</span>       <span style="color:rgb(0,135,0)">self</span>.optimality_fun,
<span class="ansi-green-fg">    353</span>       has_aux=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    354</span>       solve=<span style="color:rgb(0,135,0)">self</span>.implicit_diff_solve,
<span class="ansi-green-fg">    355</span>       reference_signature=reference_signature)
<span class="ansi-green-fg">    356</span>   run = decorator(run)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">358</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:251</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.wrapped_solver_fun</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    249</span> args, kwargs = _signature_bind(solver_fun_signature, *args, **kwargs)
<span class="ansi-green-fg">    250</span> keys, vals = <span style="color:rgb(0,135,0)">list</span>(kwargs.keys()), <span style="color:rgb(0,135,0)">list</span>(kwargs.values())
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">251</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">make_custom_vjp_solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">vals</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 12 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:207</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.make_custom_vjp_solver_fun.&lt;locals&gt;.solver_fun_flat</span><span class="ansi-blue-fg">(*flat_args)</span>
<span class="ansi-green-fg">    204</span> <span style="color:rgb(175,0,255)">@jax</span>.custom_vjp
<span class="ansi-green-fg">    205</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">solver_fun_flat</span>(*flat_args):
<span class="ansi-green-fg">    206</span>   args, kwargs = _extract_kwargs(kwarg_keys, flat_args)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:300</span>, in <span class="ansi-cyan-fg">IterativeSolver._run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    296</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">_run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    297</span>          init_params: Any,
<span class="ansi-green-fg">    298</span>          *args,
<span class="ansi-green-fg">    299</span>          **kwargs) -&gt; OptStep:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">300</span>   state = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">init_state</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    302</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We unroll the very first iteration. This allows `init_val` and `body_fun`</span>
<span class="ansi-green-fg">    303</span>   <span style="font-style:italic;color:rgb(95,135,135)"># below to have the same output type, which is a requirement of</span>
<span class="ansi-green-fg">    304</span>   <span style="font-style:italic;color:rgb(95,135,135)"># lax.while_loop and lax.scan.</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    315</span>   <span style="font-style:italic;color:rgb(95,135,135)"># of a `lax.cond` for now in order to avoid staging the initial</span>
<span class="ansi-green-fg">    316</span>   <span style="font-style:italic;color:rgb(95,135,135)"># update and the run loop. They might not be staging compatible.</span>
<span class="ansi-green-fg">    318</span>   zero_step = <span style="color:rgb(0,135,0)">self</span>._make_zero_step(init_params, state)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:105</span>, in <span class="ansi-cyan-fg">Bisection.init_state</span><span class="ansi-blue-fg">(***failed resolving arguments***)</span>
<span class="ansi-green-fg">     99</span> sign = jnp.where((lower_value &lt; <span class="ansi-green-fg">0</span>) &amp; (upper_value &gt;= <span class="ansi-green-fg">0</span>),
<span class="ansi-green-fg">    100</span>                  <span class="ansi-green-fg">1</span>,
<span class="ansi-green-fg">    101</span>                  jnp.where((lower_value &gt; <span class="ansi-green-fg">0</span>) &amp; (upper_value &lt;= <span class="ansi-green-fg">0</span>), -<span class="ansi-green-fg">1</span>, <span class="ansi-green-fg">0</span>))
<span class="ansi-green-fg">    103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span>.check_bracket:
<span class="ansi-green-fg">    104</span>   <span style="font-style:italic;color:rgb(95,135,135)"># Not jittable...</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">105</span>   <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span class="ansi-yellow-bg">sign</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">==</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">0</span>:
<span class="ansi-green-fg">    106</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">The root is not contained in [lower, upper]. </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    107</span>                      <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">`optimality_fun` evaluated at lower and upper should </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    108</span>                      <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">have opposite signs.</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">    110</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> BisectionState(iter_num=jnp.asarray(<span class="ansi-green-fg">0</span>),
<span class="ansi-green-fg">    111</span>                       value=jnp.asarray(jnp.inf),
<span class="ansi-green-fg">    112</span>                       error=jnp.asarray(jnp.inf),
<span class="ansi-green-fg">    113</span>                       low=lower, high=upper,
<span class="ansi-green-fg">    114</span>                       sign=jnp.asarray(sign),
<span class="ansi-green-fg">    115</span>                       num_fun_eval=jnp.array(<span class="ansi-green-fg">2</span>, base.NUM_EVAL_DTYPE))

    <span class="ansi-red-fg">[... skipping hidden 1 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/core.py:1604</span>, in <span class="ansi-cyan-fg">concretization_function_error.&lt;locals&gt;.error</span><span class="ansi-blue-fg">(self, arg)</span>
<span class="ansi-green-fg">   1603</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">error</span>(<span style="color:rgb(0,135,0)">self</span>, arg):
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1604</span>   <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> TracerBoolConversionError(arg)

<span class="ansi-red-fg">TracerBoolConversionError</span>: Attempted boolean conversion of traced array with shape bool[].
This BatchTracer with object id 4769498704 was created on line:
  /Users/ktayeb/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:105:9 (Bisection.init_state)
See https://jax.readthedocs.io/en/latest/errors.html#jax.errors.TracerBoolConversionError</pre>
</div>
</div>
</div>
<div id="6e684998-a764-42db-8812-9a800a007106" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bisec <span class="op">=</span> Bisection(optimality_fun<span class="op">=</span>f, lower<span class="op">=-</span><span class="dv">1</span>, upper<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bisec.run().params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/api.py:1063</span>, in <span class="ansi-cyan-fg">_mapped_axis_size.&lt;locals&gt;._get_axis_size</span><span class="ansi-blue-fg">(name, shape, axis)</span>
<span class="ansi-green-fg">   1062</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1063</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg">   1064</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">IndexError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>) <span style="font-weight:bold;color:rgb(0,135,0)">as</span> e:

<span class="ansi-red-fg">IndexError</span>: tuple index out of range

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[17]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> bisec = Bisection(optimality_fun=f, lower=-<span class="ansi-green-fg">1</span>, upper=<span class="ansi-green-fg">2</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span style="color:rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">bisec</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>.params)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:169</span>, in <span class="ansi-cyan-fg">Bisection.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    165</span>         init_params: Optional[Any] = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    166</span>         *args,
<span class="ansi-green-fg">    167</span>         **kwargs) -&gt; base.OptStep:
<span class="ansi-green-fg">    168</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We override run in order to set init_params=None by default.</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">169</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:358</span>, in <span class="ansi-cyan-fg">IterativeSolver.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    351</span>   decorator = idf.custom_root(
<span class="ansi-green-fg">    352</span>       <span style="color:rgb(0,135,0)">self</span>.optimality_fun,
<span class="ansi-green-fg">    353</span>       has_aux=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    354</span>       solve=<span style="color:rgb(0,135,0)">self</span>.implicit_diff_solve,
<span class="ansi-green-fg">    355</span>       reference_signature=reference_signature)
<span class="ansi-green-fg">    356</span>   run = decorator(run)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">358</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:251</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.wrapped_solver_fun</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    249</span> args, kwargs = _signature_bind(solver_fun_signature, *args, **kwargs)
<span class="ansi-green-fg">    250</span> keys, vals = <span style="color:rgb(0,135,0)">list</span>(kwargs.keys()), <span style="color:rgb(0,135,0)">list</span>(kwargs.values())
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">251</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">make_custom_vjp_solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">vals</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 9 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:207</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.make_custom_vjp_solver_fun.&lt;locals&gt;.solver_fun_flat</span><span class="ansi-blue-fg">(*flat_args)</span>
<span class="ansi-green-fg">    204</span> <span style="color:rgb(175,0,255)">@jax</span>.custom_vjp
<span class="ansi-green-fg">    205</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">solver_fun_flat</span>(*flat_args):
<span class="ansi-green-fg">    206</span>   args, kwargs = _extract_kwargs(kwarg_keys, flat_args)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:300</span>, in <span class="ansi-cyan-fg">IterativeSolver._run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    296</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">_run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    297</span>          init_params: Any,
<span class="ansi-green-fg">    298</span>          *args,
<span class="ansi-green-fg">    299</span>          **kwargs) -&gt; OptStep:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">300</span>   state = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">init_state</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    302</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We unroll the very first iteration. This allows `init_val` and `body_fun`</span>
<span class="ansi-green-fg">    303</span>   <span style="font-style:italic;color:rgb(95,135,135)"># below to have the same output type, which is a requirement of</span>
<span class="ansi-green-fg">    304</span>   <span style="font-style:italic;color:rgb(95,135,135)"># lax.while_loop and lax.scan.</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    315</span>   <span style="font-style:italic;color:rgb(95,135,135)"># of a `lax.cond` for now in order to avoid staging the initial</span>
<span class="ansi-green-fg">    316</span>   <span style="font-style:italic;color:rgb(95,135,135)"># update and the run loop. They might not be staging compatible.</span>
<span class="ansi-green-fg">    318</span>   zero_step = <span style="color:rgb(0,135,0)">self</span>._make_zero_step(init_params, state)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:93</span>, in <span class="ansi-cyan-fg">Bisection.init_state</span><span class="ansi-blue-fg">(***failed resolving arguments***)</span>
<span class="ansi-green-fg">     90</span> lower = jnp.asarray(<span style="color:rgb(0,135,0)">self</span>.lower, <span style="color:rgb(0,135,0)">float</span>)
<span class="ansi-green-fg">     91</span> upper = jnp.asarray(<span style="color:rgb(0,135,0)">self</span>.upper, <span style="color:rgb(0,135,0)">float</span>)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">93</span> lower_value = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">optimality_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">lower</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     94</span> upper_value = <span style="color:rgb(0,135,0)">self</span>.optimality_fun(upper, *args, **kwargs)
<span class="ansi-green-fg">     96</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = 1: the function is increasing</span>
<span class="ansi-green-fg">     97</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = -1: the function is decreasing</span>
<span class="ansi-green-fg">     98</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = 0: the root is not contained in [lower, upper]</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 4</span>, in <span class="ansi-cyan-fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(t)</span>
<span class="ansi-green-fg">      1</span> theta = <span class="ansi-green-fg">1.</span>
<span class="ansi-green-fg">      2</span> sigma2 = <span class="ansi-green-fg">1.</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> f = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> t: (<span class="ansi-yellow-bg">kappa_prime</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">-</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">theta</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">/</span><span class="ansi-yellow-bg">sigma2</span><span class="ansi-yellow-bg">)</span> - theta)
<span class="ansi-green-fg">      5</span> f(np.array([<span class="ansi-green-fg">1.</span>, <span class="ansi-green-fg">4.</span>]))

    <span class="ansi-red-fg">[... skipping hidden 19 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/api.py:1067</span>, in <span class="ansi-cyan-fg">_mapped_axis_size.&lt;locals&gt;._get_axis_size</span><span class="ansi-blue-fg">(name, shape, axis)</span>
<span class="ansi-green-fg">   1065</span> min_rank = axis + <span class="ansi-green-fg">1</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> axis &gt;= <span class="ansi-green-fg">0</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span> -axis
<span class="ansi-green-fg">   1066</span> <span style="font-style:italic;color:rgb(95,135,135)"># TODO(mattjj): better error message here</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1067</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg">   1068</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> was requested to map its argument along axis </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>axis<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1069</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">which implies that its rank should be at least </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>min_rank<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1070</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">but is only </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">len</span>(shape)<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> (its shape is </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>shape<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">)</span><span class="ansi-yellow-fg">"</span>) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">e</span>

<span class="ansi-red-fg">ValueError</span>: vmap was requested to map its argument along axis 0, which implies that its rank should be at least 1, but is only 0 (its shape is ())</pre>
</div>
</div>
</div>
<div id="b1d882a6-742c-475b-8fe9-b714c81aea45" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>F(np.arange(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([ -2,  -2,   4,  22,  58, 118, 208, 334, 502, 718])</code></pre>
</div>
</div>
<div id="b7b3ca08-e7b1-43f7-8121-e9f3c64af733" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>kappa_prime <span class="op">=</span> <span class="kw">lambda</span> theta: theta</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> t: (kappa_prime((t <span class="op">-</span> theta)<span class="op">/</span>sigma2) <span class="op">-</span> theta)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>bisec <span class="op">=</span> Bisection(optimality_fun<span class="op">=</span>f, lower<span class="op">=</span><span class="dv">1</span>, upper<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>bisec.run().params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Array(2.0000076, dtype=float32)</code></pre>
</div>
</div>
<div id="8de2216e-44b6-498f-ace0-a447bbfeb648" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jaxopt <span class="im">import</span> Bisection</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> t: (kappa_prime((t <span class="op">-</span> theta)<span class="op">/</span>sigma2) <span class="op">-</span> theta)[<span class="va">None</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>bisec <span class="op">=</span> Bisection(optimality_fun<span class="op">=</span>f, lower<span class="op">=</span><span class="dv">1</span>, upper<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>bisec.run().</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/api.py:1063</span>, in <span class="ansi-cyan-fg">_mapped_axis_size.&lt;locals&gt;._get_axis_size</span><span class="ansi-blue-fg">(name, shape, axis)</span>
<span class="ansi-green-fg">   1062</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1063</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">shape</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">axis</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg">   1064</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">IndexError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>) <span style="font-weight:bold;color:rgb(0,135,0)">as</span> e:

<span class="ansi-red-fg">IndexError</span>: tuple index out of range

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[109]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      2</span> f = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> t: (kappa_prime((t - theta)/sigma2) - theta)[<span style="font-weight:bold;color:rgb(0,135,0)">None</span>]
<span class="ansi-green-fg">      3</span> bisec = Bisection(optimality_fun=f, lower=<span class="ansi-green-fg">1</span>, upper=<span class="ansi-green-fg">4</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> <span class="ansi-yellow-bg">bisec</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:169</span>, in <span class="ansi-cyan-fg">Bisection.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    165</span>         init_params: Optional[Any] = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    166</span>         *args,
<span class="ansi-green-fg">    167</span>         **kwargs) -&gt; base.OptStep:
<span class="ansi-green-fg">    168</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We override run in order to set init_params=None by default.</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">169</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:358</span>, in <span class="ansi-cyan-fg">IterativeSolver.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    351</span>   decorator = idf.custom_root(
<span class="ansi-green-fg">    352</span>       <span style="color:rgb(0,135,0)">self</span>.optimality_fun,
<span class="ansi-green-fg">    353</span>       has_aux=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    354</span>       solve=<span style="color:rgb(0,135,0)">self</span>.implicit_diff_solve,
<span class="ansi-green-fg">    355</span>       reference_signature=reference_signature)
<span class="ansi-green-fg">    356</span>   run = decorator(run)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">358</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:251</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.wrapped_solver_fun</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    249</span> args, kwargs = _signature_bind(solver_fun_signature, *args, **kwargs)
<span class="ansi-green-fg">    250</span> keys, vals = <span style="color:rgb(0,135,0)">list</span>(kwargs.keys()), <span style="color:rgb(0,135,0)">list</span>(kwargs.values())
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">251</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">make_custom_vjp_solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">vals</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 9 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:207</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.make_custom_vjp_solver_fun.&lt;locals&gt;.solver_fun_flat</span><span class="ansi-blue-fg">(*flat_args)</span>
<span class="ansi-green-fg">    204</span> <span style="color:rgb(175,0,255)">@jax</span>.custom_vjp
<span class="ansi-green-fg">    205</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">solver_fun_flat</span>(*flat_args):
<span class="ansi-green-fg">    206</span>   args, kwargs = _extract_kwargs(kwarg_keys, flat_args)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/base.py:300</span>, in <span class="ansi-cyan-fg">IterativeSolver._run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    296</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">_run</span>(<span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    297</span>          init_params: Any,
<span class="ansi-green-fg">    298</span>          *args,
<span class="ansi-green-fg">    299</span>          **kwargs) -&gt; OptStep:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">300</span>   state = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">init_state</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    302</span>   <span style="font-style:italic;color:rgb(95,135,135)"># We unroll the very first iteration. This allows `init_val` and `body_fun`</span>
<span class="ansi-green-fg">    303</span>   <span style="font-style:italic;color:rgb(95,135,135)"># below to have the same output type, which is a requirement of</span>
<span class="ansi-green-fg">    304</span>   <span style="font-style:italic;color:rgb(95,135,135)"># lax.while_loop and lax.scan.</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    315</span>   <span style="font-style:italic;color:rgb(95,135,135)"># of a `lax.cond` for now in order to avoid staging the initial</span>
<span class="ansi-green-fg">    316</span>   <span style="font-style:italic;color:rgb(95,135,135)"># update and the run loop. They might not be staging compatible.</span>
<span class="ansi-green-fg">    318</span>   zero_step = <span style="color:rgb(0,135,0)">self</span>._make_zero_step(init_params, state)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/bisection.py:93</span>, in <span class="ansi-cyan-fg">Bisection.init_state</span><span class="ansi-blue-fg">(***failed resolving arguments***)</span>
<span class="ansi-green-fg">     90</span> lower = jnp.asarray(<span style="color:rgb(0,135,0)">self</span>.lower, <span style="color:rgb(0,135,0)">float</span>)
<span class="ansi-green-fg">     91</span> upper = jnp.asarray(<span style="color:rgb(0,135,0)">self</span>.upper, <span style="color:rgb(0,135,0)">float</span>)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">93</span> lower_value = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">optimality_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">lower</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     94</span> upper_value = <span style="color:rgb(0,135,0)">self</span>.optimality_fun(upper, *args, **kwargs)
<span class="ansi-green-fg">     96</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = 1: the function is increasing</span>
<span class="ansi-green-fg">     97</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = -1: the function is decreasing</span>
<span class="ansi-green-fg">     98</span> <span style="font-style:italic;color:rgb(95,135,135)"># sign = 0: the root is not contained in [lower, upper]</span>

<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[109]</span><span class="ansi-green-fg">, line 2</span>, in <span class="ansi-cyan-fg">&lt;lambda&gt;</span><span class="ansi-blue-fg">(t)</span>
<span class="ansi-green-fg">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">jaxopt</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> Bisection
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> f = <span style="font-weight:bold;color:rgb(0,135,0)">lambda</span> t: (<span class="ansi-yellow-bg">kappa_prime</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">t</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">-</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">theta</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">/</span><span class="ansi-yellow-bg">sigma2</span><span class="ansi-yellow-bg">)</span> - theta)[<span style="font-weight:bold;color:rgb(0,135,0)">None</span>]
<span class="ansi-green-fg">      3</span> bisec = Bisection(optimality_fun=f, lower=<span class="ansi-green-fg">1</span>, upper=<span class="ansi-green-fg">4</span>)
<span class="ansi-green-fg">      4</span> bisec.run()

    <span class="ansi-red-fg">[... skipping hidden 19 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jax/_src/api.py:1067</span>, in <span class="ansi-cyan-fg">_mapped_axis_size.&lt;locals&gt;._get_axis_size</span><span class="ansi-blue-fg">(name, shape, axis)</span>
<span class="ansi-green-fg">   1065</span> min_rank = axis + <span class="ansi-green-fg">1</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> axis &gt;= <span class="ansi-green-fg">0</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span> -axis
<span class="ansi-green-fg">   1066</span> <span style="font-style:italic;color:rgb(95,135,135)"># TODO(mattjj): better error message here</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1067</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg">   1068</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>name<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> was requested to map its argument along axis </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>axis<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1069</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">which implies that its rank should be at least </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>min_rank<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1070</span>     <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">but is only </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">len</span>(shape)<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> (its shape is </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>shape<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg">)</span><span class="ansi-yellow-fg">"</span>) <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">e</span>

<span class="ansi-red-fg">ValueError</span>: vmap was requested to map its argument along axis 0, which implies that its rank should be at least 1, but is only 0 (its shape is ())</pre>
</div>
</div>
</div>
<div id="ed654503-c741-40c4-8cf4-be7fdbff8d65" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> ScipyRootFinding(optimality_fun<span class="op">=</span>f)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>solver.run(np.ones(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[91]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> solver = ScipyRootFinding(optimality_fun=f)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">solver</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">run</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">np</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ones</span><span class="ansi-yellow-bg">(</span><span class="ansi-green-fg ansi-yellow-bg">1</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:251</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.wrapped_solver_fun</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    249</span> args, kwargs = _signature_bind(solver_fun_signature, *args, **kwargs)
<span class="ansi-green-fg">    250</span> keys, vals = <span style="color:rgb(0,135,0)">list</span>(kwargs.keys()), <span style="color:rgb(0,135,0)">list</span>(kwargs.values())
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">251</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">make_custom_vjp_solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">keys</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">vals</span><span class="ansi-yellow-bg">)</span>

    <span class="ansi-red-fg">[... skipping hidden 9 frame]</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/implicit_diff.py:207</span>, in <span class="ansi-cyan-fg">_custom_root.&lt;locals&gt;.make_custom_vjp_solver_fun.&lt;locals&gt;.solver_fun_flat</span><span class="ansi-blue-fg">(*flat_args)</span>
<span class="ansi-green-fg">    204</span> <span style="color:rgb(175,0,255)">@jax</span>.custom_vjp
<span class="ansi-green-fg">    205</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">solver_fun_flat</span>(*flat_args):
<span class="ansi-green-fg">    206</span>   args, kwargs = _extract_kwargs(kwarg_keys, flat_args)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">solver_fun</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/jaxopt/_src/scipy_wrappers.py:532</span>, in <span class="ansi-cyan-fg">ScipyRootFinding.run</span><span class="ansi-blue-fg">(self, init_params, *args, **kwargs)</span>
<span class="ansi-green-fg">    527</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> jnp_to_onp(value_jnp, <span style="color:rgb(0,135,0)">self</span>.dtype), jac_jnp_to_onp(jacs_jnp)
<span class="ansi-green-fg">    529</span> <span style="font-style:italic;color:rgb(95,135,135)"># Argument `args` is unused but must be not None to ensure that some sanity checks are performed</span>
<span class="ansi-green-fg">    530</span> <span style="font-style:italic;color:rgb(95,135,135)"># correctly in Scipy for optimizers that don't use the Jacobian (such as Broyden).</span>
<span class="ansi-green-fg">    531</span> <span style="font-style:italic;color:rgb(95,135,135)"># See the related issue: https://github.com/google/jaxopt/issues/290</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">532</span> res = <span class="ansi-yellow-bg">osp</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">optimize</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">root</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">scipy_fun</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">jnp_to_onp</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">init_params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    533</span> <span class="ansi-yellow-bg">                        </span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">(</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">None</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    534</span> <span class="ansi-yellow-bg">                        </span><span class="ansi-yellow-bg">jac</span><span class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    535</span> <span class="ansi-yellow-bg">                        </span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">tol</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    536</span> <span class="ansi-yellow-bg">                        </span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    537</span> <span class="ansi-yellow-bg">                        </span><span class="ansi-yellow-bg">options</span><span class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">options</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    539</span> params = tree_util.tree_map(jnp.asarray, onp_to_jnp(res.x))
<span class="ansi-green-fg">    541</span> <span style="font-style:italic;color:rgb(95,135,135)"># NOTE: maybe there is a better way to do the following (zramzi)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/research/self-tuning-penalty/.venv/lib/python3.13/site-packages/scipy/optimize/_root.py:222</span>, in <span class="ansi-cyan-fg">root</span><span class="ansi-blue-fg">(fun, x0, args, method, jac, tol, callback, options)</span>
<span class="ansi-green-fg">    219</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(args, <span style="color:rgb(0,135,0)">tuple</span>):
<span class="ansi-green-fg">    220</span>     args = (args,)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">222</span> meth = <span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">lower</span>()
<span class="ansi-green-fg">    223</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> options <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">    224</span>     options = {}

<span class="ansi-red-fg">AttributeError</span>: 'NoneType' object has no attribute 'lower'</pre>
</div>
</div>
</div>
<div id="0a80bc5e-f70c-43cd-8e86-4a1701b5267a" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>z[np.<span class="bu">abs</span>(f(z)).argmin()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>np.float64(-0.19919919919919926)</code></pre>
</div>
</div>
<div id="2403849c-5b39-47d3-ae40-1c74ed5b0387" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.plot(z, kappa_prime(z))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6295fcf9-ec85-4962-b6f6-4e1cce6b5b07" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">100</span>) <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>kappa_prime(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>Array([-2.        , -1.9595959 , -1.919192  , -1.8787879 , -1.8383838 ,
       -1.7979798 , -1.7575758 , -1.7171717 , -1.6767677 , -1.6363636 ,
       -1.5959595 , -1.5555556 , -1.5151515 , -1.4747474 , -1.4343435 ,
       -1.3939394 , -1.3535353 , -1.3131313 , -1.2727273 , -1.2323233 ,
       -1.1919192 , -1.1515151 , -1.1111112 , -1.0707071 , -1.030303  ,
       -0.989899  , -0.94949496, -0.90909094, -0.86868685, -0.82828283,
       -0.7878788 , -0.74747473, -0.7070707 , -0.6666667 , -0.6262626 ,
       -0.5858586 , -0.54545456, -0.5050505 , -0.46464646, -0.42424244,
       -0.3838384 , -0.34343433, -0.3030303 , -0.26262626, -0.22222222,
       -0.18181819, -0.14141414, -0.1010101 , -0.06060606, -0.02020202,
        0.02020202,  0.06060606,  0.1010101 ,  0.14141414,  0.18181819,
        0.22222222,  0.26262626,  0.3030303 ,  0.34343433,  0.3838384 ,
        0.42424244,  0.46464646,  0.5050505 ,  0.54545456,  0.5858586 ,
        0.6262626 ,  0.6666667 ,  0.7070707 ,  0.74747473,  0.7878788 ,
        0.82828283,  0.86868685,  0.90909094,  0.94949496,  0.989899  ,
        1.030303  ,  1.0707071 ,  1.1111112 ,  1.1515151 ,  1.1919192 ,
        1.2323233 ,  1.2727273 ,  1.3131313 ,  1.3535353 ,  1.3939394 ,
        1.4343435 ,  1.4747474 ,  1.5151515 ,  1.5555556 ,  1.5959595 ,
        1.6363636 ,  1.6767677 ,  1.7171717 ,  1.7575758 ,  1.7979798 ,
        1.8383838 ,  1.8787879 ,  1.919192  ,  1.9595959 ,  2.        ],      dtype=float32)</code></pre>
</div>
</div>
<div id="d11f40f6-a0d2-4bac-890f-6d8228552b4e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(gaussian_mgf, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(mgf)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">100</span>) <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=1$'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(gaussian_mgf, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">100</span>) <span class="op">*</span> <span class="fl">2.5</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=0.1$'</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Point-Normal'</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Posterior mean'</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Penalty'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Text(0, 0.5, 'Penalty')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-22-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="916029b4-9f61-4027-8ce4-53746a22e50c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(exponential_mgf, rate<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(mgf)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="fl">0.5</span>, <span class="dv">100</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=1$'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(exponential_mgf, rate<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="fl">0.8</span>, <span class="dv">100</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=0.1$'</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Point-Exponential'</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Posterior mean'</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Penalty'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>Text(0, 0.5, 'Penalty')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="81d620b8-187d-4cdd-a3e2-4312ea7326ec" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.arcsin(np.linspace(<span class="dv">0</span>, np.pi, <span class="dv">1000</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(mgf)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=1$'</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=0.01$'</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>plt.plot(theta, penalty, label<span class="op">=</span><span class="vs">r'$\pi=0.001$'</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Point-Laplace'</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Posterior mean'</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Penalty'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/0q/xlv6fxx51c17jf27j1ws0wx40000gn/T/ipykernel_63174/650912464.py:1: RuntimeWarning: invalid value encountered in arcsin
  z = np.arcsin(np.linspace(0, np.pi, 1000))</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Text(0, 0.5, 'Penalty')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-24-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a3653def-3bff-4217-b6ab-1a21936b5bb2" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.cos(np.linspace(<span class="dv">0</span>, np.pi, <span class="dv">1000</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> z[<span class="dv">20</span>:<span class="op">-</span><span class="dv">20</span>]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(mgf)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>plt.plot(z, theta, label<span class="op">=</span><span class="vs">r'$\pi=1$'</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>plt.plot(z, theta, label<span class="op">=</span><span class="vs">r'$\pi=0.01$'</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>mgf <span class="op">=</span> partial(laplace_mgf, scale<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>point_mgf <span class="op">=</span> make_point_mgf(mgf, pi<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>kappa, kappa_prime <span class="op">=</span> make_cdf(point_mgf)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> kappa_prime(z)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>penalty <span class="op">=</span> theta <span class="op">*</span> z <span class="op">-</span> kappa(z)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>plt.plot(z, theta, label<span class="op">=</span><span class="vs">r'$\pi=0.001$'</span>)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Point-Laplace'</span>)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Posterior mean'</span>)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Penalty'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>Text(0, 0.5, 'Penalty')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="penalty_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c4281307-0df5-411d-8542-dbd2320275ef" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>array([ 1.        ,  0.99999506,  0.99998022,  0.9999555 ,  0.99992089,
        0.99987639,  0.999822  ,  0.99975772,  0.99968356,  0.99959951,
        0.99950557,  0.99940175,  0.99928805,  0.99916446,  0.999031  ,
        0.99888765,  0.99873443,  0.99857133,  0.99839835,  0.9982155 ,
        0.99802278,  0.99782019,  0.99760773,  0.9973854 ,  0.99715321,
        0.99691116,  0.99665925,  0.99639749,  0.99612587,  0.9958444 ,
        0.99555308,  0.99525192,  0.99494091,  0.99462007,  0.99428939,
        0.99394887,  0.99359853,  0.99323836,  0.99286837,  0.99248855,
        0.99209893,  0.99169949,  0.99129025,  0.9908712 ,  0.99044235,
        0.99000371,  0.98955528,  0.98909706,  0.98862906,  0.98815128,
        0.98766373,  0.98716641,  0.98665934,  0.9861425 ,  0.98561591,
        0.98507957,  0.9845335 ,  0.98397768,  0.98341214,  0.98283687,
        0.98225188,  0.98165717,  0.98105276,  0.98043865,  0.97981484,
        0.97918134,  0.97853816,  0.9778853 ,  0.97722277,  0.97655057,
        0.97586872,  0.97517722,  0.97447607,  0.97376528,  0.97304487,
        0.97231483,  0.97157518,  0.97082592,  0.97006706,  0.96929861,
        0.96852057,  0.96773295,  0.96693576,  0.96612901,  0.9653127 ,
        0.96448685,  0.96365146,  0.96280654,  0.9619521 ,  0.96108814,
        0.96021469,  0.95933173,  0.95843929,  0.95753737,  0.95662598,
        0.95570513,  0.95477483,  0.95383508,  0.95288591,  0.95192731,
        0.95095929,  0.94998187,  0.94899506,  0.94799886,  0.94699329,
        0.94597835,  0.94495406,  0.94392042,  0.94287745,  0.94182515,
        0.94076354,  0.93969262,  0.93861241,  0.93752292,  0.93642416,
        0.93531614,  0.93419886,  0.93307235,  0.93193662,  0.93079166,
        0.9296375 ,  0.92847415,  0.92730161,  0.92611991,  0.92492904,
        0.92372903,  0.92251988,  0.92130162,  0.92007423,  0.91883775,
        0.91759219,  0.91633755,  0.91507385,  0.91380109,  0.9125193 ,
        0.91122849,  0.90992867,  0.90861984,  0.90730203,  0.90597525,
        0.90463951,  0.90329482,  0.9019412 ,  0.90057866,  0.89920721,
        0.89782688,  0.89643766,  0.89503957,  0.89363264,  0.89221687,
        0.89079227,  0.88935887,  0.88791667,  0.88646569,  0.88500594,
        0.88353744,  0.8820602 ,  0.88057424,  0.87907957,  0.87757621,
        0.87606417,  0.87454347,  0.87301411,  0.87147613,  0.86992952,
        0.86837431,  0.86681052,  0.86523815,  0.86365722,  0.86206776,
        0.86046977,  0.85886327,  0.85724827,  0.8556248 ,  0.85399287,
        0.85235249,  0.85070368,  0.84904646,  0.84738084,  0.84570685,
        0.84402448,  0.84233378,  0.84063474,  0.83892739,  0.83721174,
        0.83548781,  0.83375562,  0.83201519,  0.83026652,  0.82850965,
        0.82674458,  0.82497134,  0.82318994,  0.82140039,  0.81960273,
        0.81779696,  0.8159831 ,  0.81416117,  0.81233119,  0.81049318,
        0.80864715,  0.80679312,  0.80493112,  0.80306115,  0.80118325,
        0.79929742,  0.79740368,  0.79550207,  0.79359258,  0.79167524,
        0.78975008,  0.78781711,  0.78587634,  0.7839278 ,  0.78197151,
        0.78000749,  0.77803575,  0.77605632,  0.77406922,  0.77207446,
        0.77007206,  0.76806205,  0.76604444,  0.76401926,  0.76198652,
        0.75994625,  0.75789846,  0.75584317,  0.75378041,  0.7517102 ,
        0.74963255,  0.74754749,  0.74545504,  0.74335521,  0.74124804,
        0.73913353,  0.73701171,  0.7348826 ,  0.73274623,  0.73060261,
        0.72845177,  0.72629372,  0.72412849,  0.72195609,  0.71977656,
        0.71758991,  0.71539616,  0.71319534,  0.71098747,  0.70877256,
        0.70655065,  0.70432174,  0.70208588,  0.69984306,  0.69759333,
        0.6953367 ,  0.69307319,  0.69080283,  0.68852564,  0.68624164,
        0.68395085,  0.6816533 ,  0.679349  ,  0.67703799,  0.67472028,
        0.6723959 ,  0.67006487,  0.66772722,  0.66538296,  0.66303212,
        0.66067472,  0.65831079,  0.65594035,  0.65356343,  0.65118003,
        0.6487902 ,  0.64639396,  0.64399132,  0.64158231,  0.63916696,
        0.63674529,  0.63431732,  0.63188307,  0.62944258,  0.62699586,
        0.62454294,  0.62208385,  0.6196186 ,  0.61714723,  0.61466975,
        0.6121862 ,  0.60969659,  0.60720095,  0.60469931,  0.60219168,
        0.5996781 ,  0.59715859,  0.59463318,  0.59210188,  0.58956473,
        0.58702175,  0.58447296,  0.58191839,  0.57935807,  0.57679202,
        0.57422026,  0.57164283,  0.56905974,  0.56647103,  0.56387671,
        0.56127682,  0.55867137,  0.5560604 ,  0.55344393,  0.55082199,
        0.5481946 ,  0.54556179,  0.54292359,  0.54028001,  0.5376311 ,
        0.53497686,  0.53231734,  0.52965255,  0.52698252,  0.52430728,
        0.52162686,  0.51894128,  0.51625056,  0.51355474,  0.51085385,
        0.5081479 ,  0.50543692,  0.50272095,  0.5       ,  0.49727411,
        0.4945433 ,  0.4918076 ,  0.48906704,  0.48632164,  0.48357143,
        0.48081644,  0.4780567 ,  0.47529222,  0.47252305,  0.4697492 ,
        0.46697071,  0.4641876 ,  0.4613999 ,  0.45860764,  0.45581084,
        0.45300953,  0.45020374,  0.44739351,  0.44457884,  0.44175978,
        0.43893635,  0.43610858,  0.4332765 ,  0.43044014,  0.42759951,
        0.42475466,  0.42190561,  0.41905238,  0.41619501,  0.41333353,
        0.41046795,  0.40759832,  0.40472466,  0.40184699,  0.39896535,
        0.39607977,  0.39319026,  0.39029687,  0.38739962,  0.38449854,
        0.38159366,  0.378685  ,  0.3757726 ,  0.37285648,  0.36993667,
        0.36701321,  0.36408611,  0.36115542,  0.35822115,  0.35528334,
        0.35234202,  0.34939721,  0.34644895,  0.34349726,  0.34054218,
        0.33758372,  0.33462193,  0.33165683,  0.32868845,  0.32571682,
        0.32274197,  0.31976392,  0.31678272,  0.31379838,  0.31081094,
        0.30782042,  0.30482686,  0.30183029,  0.29883073,  0.29582821,
        0.29282277,  0.28981444,  0.28680323,  0.28378919,  0.28077235,
        0.27775273,  0.27473036,  0.27170527,  0.2686775 ,  0.26564707,
        0.26261401,  0.25957836,  0.25654014,  0.25349938,  0.25045612,
        0.24741038,  0.24436219,  0.24131158,  0.23825859,  0.23520324,
        0.23214557,  0.2290856 ,  0.22602337,  0.2229589 ,  0.21989222,
        0.21682337,  0.21375238,  0.21067927,  0.20760408,  0.20452683,
        0.20144757,  0.19836631,  0.19528309,  0.19219794,  0.18911088,
        0.18602196,  0.1829312 ,  0.17983863,  0.17674428,  0.17364818,
        0.17055036,  0.16745086,  0.1643497 ,  0.16124692,  0.15814254,
        0.1550366 ,  0.15192912,  0.14882015,  0.1457097 ,  0.14259781,
        0.13948451,  0.13636983,  0.1332538 ,  0.13013645,  0.12701782,
        0.12389793,  0.12077682,  0.11765451,  0.11453103,  0.11140643,
        0.10828072,  0.10515394,  0.10202613,  0.0988973 ,  0.0957675 ,
        0.09263674,  0.08950508,  0.08637252,  0.08323912,  0.08010489,
        0.07696986,  0.07383408,  0.07069757,  0.06756035,  0.06442247,
        0.06128395,  0.05814483,  0.05500513,  0.05186489,  0.04872413,
        0.04558289,  0.0424412 ,  0.03929909,  0.0361566 ,  0.03301374,
        0.02987056,  0.02672708,  0.02358334,  0.02043937,  0.01729519,
        0.01415085,  0.01100636,  0.00786176,  0.00471709,  0.00157237,
       -0.00157237, -0.00471709, -0.00786176, -0.01100636, -0.01415085,
       -0.01729519, -0.02043937, -0.02358334, -0.02672708, -0.02987056,
       -0.03301374, -0.0361566 , -0.03929909, -0.0424412 , -0.04558289,
       -0.04872413, -0.05186489, -0.05500513, -0.05814483, -0.06128395,
       -0.06442247, -0.06756035, -0.07069757, -0.07383408, -0.07696986,
       -0.08010489, -0.08323912, -0.08637252, -0.08950508, -0.09263674,
       -0.0957675 , -0.0988973 , -0.10202613, -0.10515394, -0.10828072,
       -0.11140643, -0.11453103, -0.11765451, -0.12077682, -0.12389793,
       -0.12701782, -0.13013645, -0.1332538 , -0.13636983, -0.13948451,
       -0.14259781, -0.1457097 , -0.14882015, -0.15192912, -0.1550366 ,
       -0.15814254, -0.16124692, -0.1643497 , -0.16745086, -0.17055036,
       -0.17364818, -0.17674428, -0.17983863, -0.1829312 , -0.18602196,
       -0.18911088, -0.19219794, -0.19528309, -0.19836631, -0.20144757,
       -0.20452683, -0.20760408, -0.21067927, -0.21375238, -0.21682337,
       -0.21989222, -0.2229589 , -0.22602337, -0.2290856 , -0.23214557,
       -0.23520324, -0.23825859, -0.24131158, -0.24436219, -0.24741038,
       -0.25045612, -0.25349938, -0.25654014, -0.25957836, -0.26261401,
       -0.26564707, -0.2686775 , -0.27170527, -0.27473036, -0.27775273,
       -0.28077235, -0.28378919, -0.28680323, -0.28981444, -0.29282277,
       -0.29582821, -0.29883073, -0.30183029, -0.30482686, -0.30782042,
       -0.31081094, -0.31379838, -0.31678272, -0.31976392, -0.32274197,
       -0.32571682, -0.32868845, -0.33165683, -0.33462193, -0.33758372,
       -0.34054218, -0.34349726, -0.34644895, -0.34939721, -0.35234202,
       -0.35528334, -0.35822115, -0.36115542, -0.36408611, -0.36701321,
       -0.36993667, -0.37285648, -0.3757726 , -0.378685  , -0.38159366,
       -0.38449854, -0.38739962, -0.39029687, -0.39319026, -0.39607977,
       -0.39896535, -0.40184699, -0.40472466, -0.40759832, -0.41046795,
       -0.41333353, -0.41619501, -0.41905238, -0.42190561, -0.42475466,
       -0.42759951, -0.43044014, -0.4332765 , -0.43610858, -0.43893635,
       -0.44175978, -0.44457884, -0.44739351, -0.45020374, -0.45300953,
       -0.45581084, -0.45860764, -0.4613999 , -0.4641876 , -0.46697071,
       -0.4697492 , -0.47252305, -0.47529222, -0.4780567 , -0.48081644,
       -0.48357143, -0.48632164, -0.48906704, -0.4918076 , -0.4945433 ,
       -0.49727411, -0.5       , -0.50272095, -0.50543692, -0.5081479 ,
       -0.51085385, -0.51355474, -0.51625056, -0.51894128, -0.52162686,
       -0.52430728, -0.52698252, -0.52965255, -0.53231734, -0.53497686,
       -0.5376311 , -0.54028001, -0.54292359, -0.54556179, -0.5481946 ,
       -0.55082199, -0.55344393, -0.5560604 , -0.55867137, -0.56127682,
       -0.56387671, -0.56647103, -0.56905974, -0.57164283, -0.57422026,
       -0.57679202, -0.57935807, -0.58191839, -0.58447296, -0.58702175,
       -0.58956473, -0.59210188, -0.59463318, -0.59715859, -0.5996781 ,
       -0.60219168, -0.60469931, -0.60720095, -0.60969659, -0.6121862 ,
       -0.61466975, -0.61714723, -0.6196186 , -0.62208385, -0.62454294,
       -0.62699586, -0.62944258, -0.63188307, -0.63431732, -0.63674529,
       -0.63916696, -0.64158231, -0.64399132, -0.64639396, -0.6487902 ,
       -0.65118003, -0.65356343, -0.65594035, -0.65831079, -0.66067472,
       -0.66303212, -0.66538296, -0.66772722, -0.67006487, -0.6723959 ,
       -0.67472028, -0.67703799, -0.679349  , -0.6816533 , -0.68395085,
       -0.68624164, -0.68852564, -0.69080283, -0.69307319, -0.6953367 ,
       -0.69759333, -0.69984306, -0.70208588, -0.70432174, -0.70655065,
       -0.70877256, -0.71098747, -0.71319534, -0.71539616, -0.71758991,
       -0.71977656, -0.72195609, -0.72412849, -0.72629372, -0.72845177,
       -0.73060261, -0.73274623, -0.7348826 , -0.73701171, -0.73913353,
       -0.74124804, -0.74335521, -0.74545504, -0.74754749, -0.74963255,
       -0.7517102 , -0.75378041, -0.75584317, -0.75789846, -0.75994625,
       -0.76198652, -0.76401926, -0.76604444, -0.76806205, -0.77007206,
       -0.77207446, -0.77406922, -0.77605632, -0.77803575, -0.78000749,
       -0.78197151, -0.7839278 , -0.78587634, -0.78781711, -0.78975008,
       -0.79167524, -0.79359258, -0.79550207, -0.79740368, -0.79929742,
       -0.80118325, -0.80306115, -0.80493112, -0.80679312, -0.80864715,
       -0.81049318, -0.81233119, -0.81416117, -0.8159831 , -0.81779696,
       -0.81960273, -0.82140039, -0.82318994, -0.82497134, -0.82674458,
       -0.82850965, -0.83026652, -0.83201519, -0.83375562, -0.83548781,
       -0.83721174, -0.83892739, -0.84063474, -0.84233378, -0.84402448,
       -0.84570685, -0.84738084, -0.84904646, -0.85070368, -0.85235249,
       -0.85399287, -0.8556248 , -0.85724827, -0.85886327, -0.86046977,
       -0.86206776, -0.86365722, -0.86523815, -0.86681052, -0.86837431,
       -0.86992952, -0.87147613, -0.87301411, -0.87454347, -0.87606417,
       -0.87757621, -0.87907957, -0.88057424, -0.8820602 , -0.88353744,
       -0.88500594, -0.88646569, -0.88791667, -0.88935887, -0.89079227,
       -0.89221687, -0.89363264, -0.89503957, -0.89643766, -0.89782688,
       -0.89920721, -0.90057866, -0.9019412 , -0.90329482, -0.90463951,
       -0.90597525, -0.90730203, -0.90861984, -0.90992867, -0.91122849,
       -0.9125193 , -0.91380109, -0.91507385, -0.91633755, -0.91759219,
       -0.91883775, -0.92007423, -0.92130162, -0.92251988, -0.92372903,
       -0.92492904, -0.92611991, -0.92730161, -0.92847415, -0.9296375 ,
       -0.93079166, -0.93193662, -0.93307235, -0.93419886, -0.93531614,
       -0.93642416, -0.93752292, -0.93861241, -0.93969262, -0.94076354,
       -0.94182515, -0.94287745, -0.94392042, -0.94495406, -0.94597835,
       -0.94699329, -0.94799886, -0.94899506, -0.94998187, -0.95095929,
       -0.95192731, -0.95288591, -0.95383508, -0.95477483, -0.95570513,
       -0.95662598, -0.95753737, -0.95843929, -0.95933173, -0.96021469,
       -0.96108814, -0.9619521 , -0.96280654, -0.96365146, -0.96448685,
       -0.9653127 , -0.96612901, -0.96693576, -0.96773295, -0.96852057,
       -0.96929861, -0.97006706, -0.97082592, -0.97157518, -0.97231483,
       -0.97304487, -0.97376528, -0.97447607, -0.97517722, -0.97586872,
       -0.97655057, -0.97722277, -0.9778853 , -0.97853816, -0.97918134,
       -0.97981484, -0.98043865, -0.98105276, -0.98165717, -0.98225188,
       -0.98283687, -0.98341214, -0.98397768, -0.9845335 , -0.98507957,
       -0.98561591, -0.9861425 , -0.98665934, -0.98716641, -0.98766373,
       -0.98815128, -0.98862906, -0.98909706, -0.98955528, -0.99000371,
       -0.99044235, -0.9908712 , -0.99129025, -0.99169949, -0.99209893,
       -0.99248855, -0.99286837, -0.99323836, -0.99359853, -0.99394887,
       -0.99428939, -0.99462007, -0.99494091, -0.99525192, -0.99555308,
       -0.9958444 , -0.99612587, -0.99639749, -0.99665925, -0.99691116,
       -0.99715321, -0.9973854 , -0.99760773, -0.99782019, -0.99802278,
       -0.9982155 , -0.99839835, -0.99857133, -0.99873443, -0.99888765,
       -0.999031  , -0.99916446, -0.99928805, -0.99940175, -0.99950557,
       -0.99959951, -0.99968356, -0.99975772, -0.999822  , -0.99987639,
       -0.99992089, -0.9999555 , -0.99998022, -0.99999506, -1.        ])</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>